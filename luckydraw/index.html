<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lucky Wheel â€” 5G88 x EVO VIP</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b0b0f;
    --card:#111218;
    --ink:#e9e9f0;
    --muted:#9aa0ab;
    --gold:#f5c542;
    --gold-2:#ffd76b;
    --gold-3:#f1b70a;
    --success:#30d170;
    --danger:#ff5c5c;
    --accent:#6aa3ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    background: radial-gradient(1000px 700px at 20% 10%, #141726 0%, #0d0f16 40%, #090a0f 100%);
    color:var(--ink);
  }
  .wrap{
    max-width:1150px;
    margin:40px auto;
    padding:0 16px 48px;
  }
  .hero{
    display:flex; gap:28px; align-items:stretch; flex-wrap:wrap;
  }
  .panel{
    background:linear-gradient(180deg,#141622 0%, #0f1119 100%);
    border:1px solid rgba(255,255,255,.06);
    box-shadow:0 10px 30px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);
    border-radius:20px;
  }
  .panel.head{
    padding:18px 22px; display:flex; justify-content:space-between; align-items:center;
  }
  .brand{display:flex; align-items:center; gap:10px; letter-spacing:.5px}
  .brand .logo{
    width:40px; height:40px; border-radius:12px; display:grid; place-items:center;
    background: conic-gradient(from 210deg, #3c2b00, #f2c444, #3c2b00);
    box-shadow:0 0 0 2px rgba(255,215,123,.35) inset, 0 10px 20px rgba(0,0,0,.4);
    color:#111; font-weight:800;
  }
  .brand b{font-weight:800}
  .chip{
    font-size:12px; padding:6px 10px; border-radius:999px; color:#111; font-weight:700;
    background:linear-gradient(180deg,var(--gold) 0%, var(--gold-2) 100%);
    box-shadow:0 4px 14px rgba(245,197,66,.35);
  }
  .board{flex:1 1 560px; display:grid; place-items:center; position:relative; padding:16px;}
  canvas{display:block; width:100%; height:auto; max-width:560px; aspect-ratio:1/1;}
  .pointer{
    position:absolute; top:-2px; left:50%; transform:translateX(-50%);
    width:0; height:0; border-left:18px solid transparent; border-right:18px solid transparent; border-bottom:34px solid var(--gold);
    filter: drop-shadow(0 3px 12px rgba(0,0,0,.5));
  }
  .pointer::after{
    content:""; position:absolute; top:30px; left:-2px; width:4px; height:16px; background:#7b5b00; border-radius:2px; opacity:.5;
  }
  .side{flex:1 1 460px; padding:18px; display:flex; flex-direction:column; gap:16px}
  .card{padding:16px; border-radius:16px; background:var(--card); border:1px solid rgba(255,255,255,.06)}
  .card h3{margin:0 0 10px; font-size:16px; font-weight:800; letter-spacing:.3px}
  .names-list{display:grid; grid-template-columns:1fr auto; gap:8px; max-height:300px; overflow:auto;}
  .name-row{display:contents}
  .name-row span{
    background:#0f1118; border:1px solid rgba(255,255,255,.06); padding:10px 12px; border-radius:10px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }
  .name-row button{height:36px}
  .toolbar{display:flex; gap:10px; flex-wrap:wrap}
  .toolbar input[type=text]{
    flex:1; min-width:160px; height:42px; background:#0e1017; border:1px solid rgba(255,255,255,.08); border-radius:12px; color:var(--ink);
    padding:0 12px; outline:none;
  }
  .btn{
    height:42px; padding:0 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#141828; color:var(--ink);
    font-weight:700; letter-spacing:.2px; cursor:pointer; transition:.2s transform, .2s filter, .2s background;
  }
  .btn:hover{transform:translateY(-1px); filter:brightness(1.1)}
  .btn:active{transform:translateY(0)}
  .btn.gold{color:#111; background:linear-gradient(180deg,var(--gold) 0%, var(--gold-2) 100%); border:none; box-shadow:0 8px 20px rgba(245,197,66,.25)}
  .btn.danger{background:#2a1212; color:#ffd2d2; border-color:#5a2323}
  .btn.ghost{background:#0f1118}
  .hint{color:var(--muted); font-size:12px}
  .footer{display:flex; gap:10px; align-items:center; justify-content:space-between; padding:0 2px}
  .result{
    background:linear-gradient(180deg,#12131a 0%, #0e1017 100%);
    border:1px solid rgba(255,255,255,.08); padding:16px; border-radius:16px; text-align:center;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.04);
  }
  .result b{font-size:20px}
  .glow{
    position:absolute; inset:auto 0 0; transform:translateY(35%);
    height:120px; pointer-events:none; filter:blur(40px);
    background:radial-gradient(200px 100px at 50% 0%, rgba(245,197,66,.45), transparent 70%);
  }
  .mini{display:flex; gap:8px; flex-wrap:wrap}
  .mini .btn{height:36px; padding:0 12px}
  .badge{font-size:12px; color:var(--muted)}
  .divider{height:1px; background:linear-gradient(90deg, rgba(255,255,255,.05), rgba(255,255,255,.0) 10%, rgba(255,255,255,.05) 90%, rgba(255,255,255,.0)); margin:8px 0}
  .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel head">
      <div class="brand"><div class="logo">5G</div><div>
        <div style="font-size:13px; color:var(--muted)">Lucky Wheel</div>
        <b>5G88 Ã— EVO VIP</b>
      </div></div>
      <div class="chip" aria-live="polite">Fair Spin â€¢ Smooth Easing</div>
    </div>

    <div class="hero panel" style="margin-top:16px; padding:18px;">
      <div class="board">
        <div class="pointer" aria-hidden="true"></div>
        <canvas id="wheel" width="900" height="900" aria-label="Roda keberuntungan"></canvas>
        <div class="glow"></div>
      </div>

      <div class="side">
        <div class="card">
          <h3>Tambah Nama</h3>
          <div class="toolbar">
            <input type="text" id="nameInput" placeholder="Contoh: Aiman"/>
            <button class="btn gold" id="addBtn">+ Tambah</button>
            <button class="btn" id="bulkBtn" title="Tambah banyak sekaligus">Bulk</button>
          </div>
          <p class="hint">Tekan <b>Spin</b> untuk memutar. Simpan otomatis di perangkatmu.</p>
        </div>

        <div class="card">
          <h3>Daftar Nama</h3>
          <div id="names" class="names-list" role="list"></div>
          <div class="divider"></div>
          <div class="mini">
            <button class="btn ghost" id="demoBtn">Isi Contoh</button>
            <button class="btn ghost" id="shuffleBtn">Acak Warna</button>
            <button class="btn danger" id="clearBtn">Hapus Semua</button>
            <span class="badge" id="countLabel" aria-live="polite"></span>
          </div>
        </div>

        <div class="result" id="resultBox" aria-live="polite">
          <div class="badge">Pemenang</div>
          <b id="winner">â€”</b>
        </div>

        <div class="footer">
          <div class="mini">
            <button class="btn" id="spinFast">Spin Cepat</button>
            <button class="btn gold" id="spinBtn">ðŸŽ¯ SPIN</button>
            <button class="btn" id="spinSlow">Spin Lambat</button>
          </div>
          <div class="mini">
            <button class="btn ghost" id="exportBtn">Export</button>
            <button class="btn ghost" id="importBtn">Import</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');
  const R = canvas.width / 2; // radius
  let rotation = -Math.PI/2; // pointer mengarah ke atas
  let animFrame = null;

  const state = {
    names: [],
    colors: [],
    spinning: false,
  };

  const els = {
    namesWrap: document.getElementById('names'),
    nameInput: document.getElementById('nameInput'),
    addBtn: document.getElementById('addBtn'),
    bulkBtn: document.getElementById('bulkBtn'),
    clearBtn: document.getElementById('clearBtn'),
    demoBtn: document.getElementById('demoBtn'),
    shuffleBtn: document.getElementById('shuffleBtn'),
    spinBtn: document.getElementById('spinBtn'),
    spinFast: document.getElementById('spinFast'),
    spinSlow: document.getElementById('spinSlow'),
    winner: document.getElementById('winner'),
    countLabel: document.getElementById('countLabel'),
    exportBtn: document.getElementById('exportBtn'),
    importBtn: document.getElementById('importBtn'),
  };

  const GOLD_PALETTE = [
    '#f7d674', '#f2c444', '#e8b531', '#dca81e', '#c99916', '#b78b0d', '#a57d07', '#f2c444'
  ];
  const COOL_PALETTE = ['#5C7AEA','#6EE7B7','#F472B6','#F59E0B','#60A5FA','#A78BFA','#34D399','#FB7185'];

  const STORAGE_KEY = 'luckywheel.names.v1';

  function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state.names)); }
  function load(){ try{ const s = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); if(Array.isArray(s)&&s.length) state.names = s; }catch(e){} }

  function randPalette(){
    // generate soft neon gradient palette
    const bases = [COOL_PALETTE, GOLD_PALETTE][Math.random()<.5?0:1];
    const n = state.names.length || 8;
    const arr = [];
    for(let i=0;i<n;i++) arr.push(bases[i % bases.length]);
    state.colors = arr;
  }

  function resizeColors(){
    if(!state.colors.length) randPalette();
    const n = state.names.length;
    while(state.colors.length < n) state.colors.push(state.colors[state.colors.length % state.colors.length]);
    if(state.colors.length > n) state.colors.length = n;
  }

  function drawWheel(highlightIndex=-1){
    const names = state.names.length ? state.names : ['Tambahkan','Nama','Di','Sini'];
    const n = names.length;
    const step = Math.PI*2 / n;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // background disk
    ctx.save();
    ctx.translate(R,R);
    ctx.rotate(rotation);

    // outer rim
    ctx.beginPath();
    ctx.arc(0,0,R-6,0,Math.PI*2);
    const grd = ctx.createRadialGradient(0,0,R-30,0,0,R);
    grd.addColorStop(0,'#1a1c28');
    grd.addColorStop(1,'#0a0b10');
    ctx.fillStyle = grd;
    ctx.fill();

    // slices
    for(let i=0;i<n;i++){
      const start = i*step;
      const end = start + step;
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,R-22,start,end);
      ctx.closePath();

      const base = state.colors[i % state.colors.length] || COOL_PALETTE[i % COOL_PALETTE.length];
      ctx.fillStyle = base;
      ctx.globalAlpha = (i===highlightIndex)? 0.95 : 0.88;
      ctx.fill();

      // slice border
      ctx.globalAlpha = 1;
      ctx.strokeStyle = 'rgba(0,0,0,.35)';
      ctx.lineWidth = 2;
      ctx.stroke();

      // label
      ctx.save();
      ctx.fillStyle = '#0c0c0f';
      ctx.font = '700 26px Inter';
      ctx.rotate(start + step/2);
      ctx.textAlign = 'right';
      ctx.translate(R-40,0);
      // label bubble
      const txt = names[i];
      const metrics = ctx.measureText(txt);
      const w = Math.min(Math.max(metrics.width+24, 80), 260);
      const h = 36; const rx = 10;
      ctx.beginPath();
      ctx.fillStyle = 'rgba(255,255,255,.92)';
      roundRect(ctx, -w, -h/2, w, h, rx);
      ctx.fill();
      ctx.fillStyle = '#0c0c0f';
      ctx.fillText(txt, -12, 8);
      ctx.restore();
    }

    // center hub
    ctx.beginPath(); ctx.arc(0,0,70,0,Math.PI*2); ctx.fillStyle='#0e1017'; ctx.fill();
    ctx.lineWidth=2; ctx.strokeStyle='rgba(255,255,255,.1)'; ctx.stroke();

    // hub cap
    const g2 = ctx.createRadialGradient(0,0,10,0,0,60);
    g2.addColorStop(0,'#fff2b8'); g2.addColorStop(1,'#b88a06');
    ctx.beginPath(); ctx.arc(0,0,48,0,Math.PI*2); ctx.fillStyle=g2; ctx.fill();
    ctx.beginPath(); ctx.arc(0,0,12,0,Math.PI*2); ctx.fillStyle='#1b1400'; ctx.fill();

    ctx.restore();
  }

  function roundRect(c, x, y, w, h, r){
    const rr = Math.min(r, w/2, h/2);
    c.moveTo(x+rr,y);
    c.arcTo(x+w,y,x+w,y+h,rr);
    c.arcTo(x+w,y+h,x,y+h,rr);
    c.arcTo(x,y+h,x,y,rr);
    c.arcTo(x,y,x+w,y,rr);
  }

  function renderList(){
    els.namesWrap.innerHTML = '';
    state.names.forEach((nm, idx)=>{
      const row = document.createElement('div'); row.className='name-row';
      const span = document.createElement('span'); span.textContent = nm; span.title = nm;
      const btn = document.createElement('button'); btn.className='btn danger'; btn.textContent='Hapus';
      btn.addEventListener('click', ()=>{ state.names.splice(idx,1); save(); resizeColors(); update(); });
      row.appendChild(span); row.appendChild(btn); els.namesWrap.appendChild(row);
    });
    els.countLabel.textContent = `${state.names.length} nama`;
  }

  function update(){
    resizeColors();
    drawWheel();
    renderList();
  }

  function addName(n){
    n = (n||'').trim(); if(!n) return;
    state.names.push(n); save(); update(); els.nameInput.value=''; els.nameInput.focus();
  }

  function bulkAdd(){
    const raw = prompt('Masukkan nama dipisah koma atau baris baru:\nContoh: Ali, Budi, Citra');
    if(!raw) return; 
    const arr = raw.split(/\n|,/).map(s=>s.trim()).filter(Boolean);
    if(!arr.length) return;
    state.names.push(...arr); save(); update();
  }

  function chooseWinner(){
    const n = Math.max(state.names.length,1);
    // pilih index secara fair
    const idx = Math.floor(Math.random()*n);
    return idx;
  }

  function indexToTargetRotation(idx){
    const n = Math.max(state.names.length,1);
    const step = Math.PI*2 / n;
    // sudut center slice (di koordinat wheel sebelum rotasi ke pointer)
    const centerAngle = idx * step + step/2;
    // kita ingin center slice tepat di bawah pointer (pointer = -90deg = -PI/2)
    // rotation adalah rotasi keseluruhan wheel. Ketika rotation = -PI/2 - centerAngle
    // maka center slice berada di atas.
    const target = -Math.PI/2 - centerAngle;
    // tambah putaran penuh (k * 2Ï€) untuk animasi yang memuaskan
    const turns = 4 + Math.floor(Math.random()*2); // 4 atau 5 putaran
    return target + turns * (Math.PI*2);
  }

  function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }
  function easeOutQuint(t){ return 1 - Math.pow(1-t,5); }

  function spin(duration=4200, ease=easeOutQuint){
    if(state.spinning) return;
    const n = Math.max(state.names.length,1);
    if(n===0){ alert('Tambahkan nama dulu ya!'); return; }

    state.spinning = true; cancelAnimationFrame(animFrame);
    const winnerIdx = chooseWinner();
    const start = rotation;
    const target = indexToTargetRotation(winnerIdx);
    const t0 = performance.now();

    function tick(t){
      const p = Math.min(1, (t - t0) / duration);
      const k = ease(p);
      rotation = start + (target - start) * k;
      drawWheel();
      if(p < 1){ animFrame = requestAnimationFrame(tick); }
      else {
        state.spinning = false;
        rotation = target; // snap
        drawWheel(winnerIdx);
        announceWinner(winnerIdx);
        confettiBurst();
      }
    }
    animFrame = requestAnimationFrame(tick);
  }

  function announceWinner(idx){
    const nm = state.names.length? state.names[idx] : 'â€”';
    els.winner.textContent = nm;
    // ringan: vibrate jika ada
    if('vibrate' in navigator){ try{ navigator.vibrate([50,40,50]); }catch(e){} }
  }

  // ===== simple confetti =====
  function confettiBurst(){
    const N = 120; const parts=[]; const cx=canvas.getBoundingClientRect();
    const overlay = document.createElement('canvas');
    overlay.width = Math.min(900, cx.width|0); overlay.height = overlay.width; // square
    overlay.style.position='absolute'; overlay.style.pointerEvents='none';
    overlay.style.inset='0'; overlay.style.margin='auto';
    const octx = overlay.getContext('2d');
    document.querySelector('.board').appendChild(overlay);

    for(let i=0;i<N;i++) parts.push({
      x: overlay.width/2, y: overlay.height*0.15,
      vx: (Math.random()-0.5)*6, vy: Math.random()*-4-2,
      g: 0.15 + Math.random()*0.05,
      life: 60 + (Math.random()*30|0),
      c: COOL_PALETTE[i%COOL_PALETTE.length]
    });

    function step(){
      octx.clearRect(0,0,overlay.width,overlay.height);
      parts.forEach(p=>{
        p.life--; p.vy += p.g; p.x += p.vx; p.y += p.vy;
        octx.save(); octx.fillStyle=p.c; octx.translate(p.x,p.y); octx.rotate(p.x*0.05);
        octx.fillRect(-3,-3,6,6); octx.restore();
      });
      if(parts.some(p=>p.life>0)) requestAnimationFrame(step);
      else overlay.remove();
    }
    step();
  }

  // ===== events =====
  els.addBtn.addEventListener('click', ()=> addName(els.nameInput.value));
  els.nameInput.addEventListener('keydown', e=>{ if(e.key==='Enter') addName(els.nameInput.value); });
  els.bulkBtn.addEventListener('click', bulkAdd);
  els.clearBtn.addEventListener('click', ()=>{ if(confirm('Hapus semua nama?')){ state.names=[]; save(); update(); }});
  els.demoBtn.addEventListener('click', ()=>{
    state.names = ['Aiman','Bella','Citra','Doni','Eka','Fikri','Gita','Hendra']; save(); update();
  });
  els.shuffleBtn.addEventListener('click', ()=>{ randPalette(); update(); });
  els.spinBtn.addEventListener('click', ()=> spin(4600, easeOutQuint));
  els.spinFast.addEventListener('click', ()=> spin(3000, easeOutCubic));
  els.spinSlow.addEventListener('click', ()=> spin(6400, easeOutQuint));

  els.exportBtn.addEventListener('click', ()=>{
    const data = JSON.stringify({names: state.names}, null, 2);
    navigator.clipboard.writeText(data).then(()=> alert('Tersalin ke clipboard!'));
  });
  els.importBtn.addEventListener('click', ()=>{
    const data = prompt('Tempel data JSON hasil export:');
    if(!data) return;
    try{ const obj = JSON.parse(data); if(Array.isArray(obj.names)){ state.names = obj.names; save(); update(); }
      else alert('Format tidak valid.');
    }catch(e){ alert('JSON tidak valid.'); }
  });

  // init
  load(); randPalette(); update(); drawWheel();
})();
</script>
</body>
</html>
